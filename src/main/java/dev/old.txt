public class Main {
    pu blic Document xml;

    public Main(Document xml) {
        this.xml = xml;
        JFrame f = new JFrame();

        f.setSize(300, 500);
        f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        JPanel mainPanel = new JPanel();
        JPanel treePanel = new JPanel(new GridLayout(1, 1));

        XmlJTree myTree = new XmlJTree(this.xml);

        JTextField textField = new JTextField();
        TreeCellEditor editor = new DefaultCellEditor(textField);
        myTree.setEditable(true);
        myTree.setCellEditor(editor);

        f.add(new JScrollPane(myTree));


        JButton button_file_chooser = new JButton("Choose file");
        button_file_chooser.addActionListener(e -> {
            JFileChooser chooser = new JFileChooser();
            FileNameExtensionFilter filter = new FileNameExtensionFilter("XML file",
                    "xml");
            chooser.setFileFilter(filter);
            int returnVal = chooser.showOpenDialog(null);
            if (returnVal == JFileChooser.APPROVE_OPTION) {
                myTree.setPath(chooser.getSelectedFile().getAbsolutePath());
            }
        });


        JButton button_file_saver = new JButton("Save file");
        button_file_saver.addActionListener(e -> {
            JFileChooser chooser = new JFileChooser();
            chooser.setDialogTitle("Save file");
            int userSelection = chooser.showSaveDialog(f);
            if (userSelection == JFileChooser.APPROVE_OPTION) {
                File fileToSave = chooser.getSelectedFile();

                try {
                    JTreeExporter.exportToXml(myTree, String.valueOf(fileToSave));
                } catch (Exception ex) {
                    throw new RuntimeException(ex);
                }
                DefaultMutableTreeNode myRoot = (DefaultMutableTreeNode) myTree.getModel().getRoot();
                Enumeration en = myRoot.preorderEnumeration();
                while(en.hasMoreElements()){
                    System.out.println(en.nextElement());
                }
            }
        });

        treePanel.add(button_file_chooser);
        treePanel.add(button_file_saver);
        f.add(treePanel, BorderLayout.SOUTH);
        f.setVisible(true);
    }

}

package de.qbic.xmledit;

import org.w3c.dom.Document;
import org.w3c.dom.Element;

import javax.swing.*;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.TreeNode;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.transform.Transformer;
import javax.xml.transform.TransformerFactory;
import javax.xml.transform.dom.DOMSource;
import javax.xml.transform.stream.StreamResult;

public class JTreeExporter {
    public static void exportToXml(JTree tree, String fileName) throws Exception {
        DefaultMutableTreeNode root = (DefaultMutableTreeNode)tree.getModel().getRoot();
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document doc = builder.newDocument();
        Element xmlRoot = doc.createElement("tree");
        doc.appendChild(xmlRoot);
        buildXmlTree(xmlRoot, root, doc);
        TransformerFactory transformerFactory = TransformerFactory.newInstance();
        Transformer transformer = transformerFactory.newTransformer();
        DOMSource source = new DOMSource(doc);
        StreamResult result = new StreamResult(fileName);
        transformer.transform(source, result);
    }

    private static void buildXmlTree(Element xmlNode, TreeNode treeNode, Document doc) {
        if (treeNode == null) {
            return;
        }
        Element xmlChild = doc.createElement("node");
        xmlChild.setAttribute("name", treeNode.toString());
        xmlNode.appendChild(xmlChild);
        for (int i = 0; i < treeNode.getChildCount(); i++) {
            TreeNode child = treeNode.getChildAt(i);
            buildXmlTree(xmlChild, child, doc);
        }
    }
}

        /*
        if (change.changeType == "add" && remainingQuery.size()==0) {

            if (change.getNewValue().startsWith("@")) {
                // Adding a new Attribute node and its value
                System.out.println("adding new attribute");

                String attrName = change.getNewValue().split("=")[0].replace("@", "");
                String attrValue = change.getNewValue().split("=")[1].replace(":", "");
                ((Element) currentNode).setAttribute(attrName, attrValue);
                return;
            }
            else if (change.getNewValue().startsWith("#")) {
                // Adding a new Text Node
                System.out.println("adding new text");

                String newNodeValue = change.getNewValue().replace("#", "");
                currentNode.setTextContent(newNodeValue);
                return;
            }
            else {
                // Adding a new Element Node
                System.out.println("adding new element");

                currentNode.appendChild(root.createElement(change.getNewValue()));
                return;
            }
        }
        // if the remainingQuery has only left 1 item, then we are at the node to be edited
        else if (change.changeType == "modify" && remainingQuery.size()<=2) {

            if (remainingQuery.get(0).startsWith("@")) {
                // Editing an Attribute node
                System.out.println("editing attribute");

                String oldNodeName = remainingQuery.get(0).replace("@", "");
                String newNodeValue = change.getNewValue();
                currentNode.getAttributes().getNamedItem(oldNodeName).setNodeValue(newNodeValue);
                return;
            }
            else if (remainingQuery.get(0).startsWith(":")) {
                // Editing the value of an attribute node
                System.out.println("editing value");
                return;
            }
            else if (remainingQuery.get(0).startsWith("#")) {
                // Editing a Text Node
                System.out.println("editing text");

                String newNodeValue = change.getNewValue();
                currentNode.setTextContent(newNodeValue);
                return;
            }
            else if (remainingQuery.size()==0) {
                // Editing an Element Node
                System.out.println("editing element");
                return;
            }
        }
        // If the remainingQuery is empty, we are at the node that is to be deleted
        else if (change.changeType == "delete") {
            if (remainingQuery.size()>0){
                if (remainingQuery.get(0).startsWith("@")) {
                    // Deleting an Attribute node
                    System.out.println("deleting attribute");
                    String oldNodeName = remainingQuery.get(0).replace("@", "");
                    currentNode.getAttributes().removeNamedItem(oldNodeName);
                    return;
                }
                else if (remainingQuery.get(0).startsWith(":")) {
                    // Deleting the value of an attribute node
                    System.out.println("deleting value");
                    String oldNodeName = remainingQuery.get(0).replace(":", "");
                    return;
                }
                else if (remainingQuery.get(0).startsWith("#")) {
                    // Deleting a Text Node
                    currentNode.setTextContent("");
                    System.out.println("deleting text");
                    return;
                }
            }
            else if (remainingQuery.size()==0){
                // Deleting an Element Node
                currentNode.getParentNode().removeChild(currentNode);
                System.out.println("deleting element");
                return;
            }
        }
        */